<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Maki: Pre- and Post-External-Transition Hooks</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Maki
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('external-transition-hook.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Pre- and Post-External-Transition Hooks </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__2home_2florian_2Development_2maki_2src_2doc_2extra_2hook_2external-transition"></a></p>
<p>You can ask <span class="tt"><a class="el" href="classmaki_1_1machine.html" title="The state machine implementation template.">maki::machine</a></span> to call hooks before or after the state machine executes a non-internal transition in a region.</p>
<p>These hooks are configured by calling overloads and variants of the following functions:</p><ul>
<li><span class="tt"><a class="el" href="classmaki_1_1machine__conf.html#aa86fa6e3284b7a4eaf86777c1a44db1c" title="Specifies a hook to be called before any external transition.">maki::machine_conf::pre_external_transition_hook_crste()</a></span>;</li>
<li><span class="tt"><a class="el" href="classmaki_1_1machine__conf.html#a19e7c7c870c062b123855920dcf883a6" title="Specifies a hook to be called after any external transition.">maki::machine_conf::post_external_transition_hook_crste()</a></span>.</li>
</ul>
<p>These hooks take the following arguments:</p><ul>
<li><span class="tt">ctx</span>, the context of the state machine;</li>
<li><span class="tt">region</span> (of type <span class="tt">const <a class="el" href="classmaki_1_1region.html" title="Represents an region.">maki::region</a>&lt;...&gt;&amp;</span>), the region where the transition is happening;</li>
<li><span class="tt">source_state</span> (of type <span class="tt">const <a class="el" href="classmaki_1_1state.html" title="Represents a state.">maki::state</a>&lt;...&gt;&amp;</span>), the source state;</li>
<li><span class="tt">target_state</span> (of type <span class="tt">const <a class="el" href="classmaki_1_1state.html" title="Represents a state.">maki::state</a>&lt;...&gt;&amp;</span>), the target state;</li>
<li><span class="tt">event</span>, the event that triggered the transition.</li>
</ul>
<p>These hooks are particularly useful to log transitions. For example:</p>
<div class="fragment"><div class="line">    .pre_external_transition_hook_crste</div>
<div class="line">    (</div>
<div class="line">        [](context&amp; <span class="comment">/*ctx*/</span>, <span class="keyword">const</span> <span class="keyword">auto</span>&amp; region, <span class="keyword">const</span> <span class="keyword">auto</span>&amp; source_state, <span class="keyword">const</span> <span class="keyword">auto</span>&amp; target_state, <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <span class="comment">/*event*/</span>)</div>
<div class="line">        {</div>
<div class="line">            log_info</div>
<div class="line">            (</div>
<div class="line">                <span class="stringliteral">&quot;Executing transition in &quot;</span>,</div>
<div class="line">                region.path().to_string(),</div>
<div class="line">                <span class="stringliteral">&quot;: &quot;</span>,</div>
<div class="line">                source_state.pretty_name(),</div>
<div class="line">                <span class="stringliteral">&quot; -&gt; &quot;</span>,</div>
<div class="line">                target_state.pretty_name(),</div>
<div class="line">                <span class="stringliteral">&quot;...&quot;</span></div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">    )</div>
<div class="line">    .post_external_transition_hook_crste</div>
<div class="line">    (</div>
<div class="line">        [](context&amp; <span class="comment">/*ctx*/</span>, <span class="keyword">const</span> <span class="keyword">auto</span>&amp; region, <span class="keyword">const</span> <span class="keyword">auto</span>&amp; source_state, <span class="keyword">const</span> <span class="keyword">auto</span>&amp; target_state, <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <span class="comment">/*event*/</span>)</div>
<div class="line">        {</div>
<div class="line">            log_info</div>
<div class="line">            (</div>
<div class="line">                <span class="stringliteral">&quot;Executed transition in &quot;</span>,</div>
<div class="line">                region.path().to_string(),</div>
<div class="line">                <span class="stringliteral">&quot;: &quot;</span>,</div>
<div class="line">                source_state.pretty_name(),</div>
<div class="line">                <span class="stringliteral">&quot; -&gt; &quot;</span>,</div>
<div class="line">                target_state.pretty_name(),</div>
<div class="line">                <span class="stringliteral">&quot;.&quot;</span></div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">    )</div>
</div><!-- fragment --><p>This is the kind of output you can obtain:</p>
<div class="fragment"><div class="line">Executing transition in 0:  -&gt; initializing...</div>
<div class="line">Executed transition in 0:  -&gt; initializing.</div>
<div class="line">Executing transition in 0: initializing -&gt; running...</div>
<div class="line">Executed transition in 0: initializing -&gt; running.</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>In the output above, <span class="tt">0</span> is the path to the first topmost region of the state machine. Also, see <a class="el" href="#external-transition-hook-null-state">Note: The Null Dummy State Object</a> for an explanation about the empty state names.</dd></dl>
<h1 class="doxsection"><a class="anchor" id="autotoc_md57"></a>
Note: Transition Decomposition</h1>
<p>When composite states are involved, a unique transition can trigger several invocations of the external transition hooks. This is due to the fact that external transition hooks see transitions from the point of view of every region.</p>
<p>Consider the state machine below, which defines the behavior of some kind of plane:</p>
<div class="plantumlgraph">
<img src="external_transition_hook_decomposition.png" />
</div>
<p>Whenever an <span class="tt">error</span> occurs while, say, the plane is starting its left reactor and deploying its right wing, the external transition hooks log the following messages:</p>
<div class="fragment"><div class="line">Executing transition in 0: initializing -&gt; failing...</div>
<div class="line">Executing transition in 0/initializing/0: starting_left_reactor -&gt; ...</div>
<div class="line">Executed transition in 0/initializing/0: starting_left_reactor -&gt; .</div>
<div class="line">Executing transition in 0/initializing/1: deploying_right_wing -&gt; ...</div>
<div class="line">Executed transition in 0/initializing/1: deploying_right_wing -&gt; .</div>
<div class="line">Executed transition in 0: initializing -&gt; failing.</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>See <a class="el" href="#external-transition-hook-null-state">Note: The Null Dummy State Object</a> for an explanation about the empty state names.</dd></dl>
<p>From the point of view of the topmost region (path <span class="tt">0</span>), a transition from <span class="tt">initializing</span> to <span class="tt">failing</span> occurs and triggers these subtransitions:</p><ol type="1">
<li>from the point of view of the first region of <span class="tt">initializing</span> (path <span class="tt">0/initializing/0</span>), a transition from <span class="tt">starting_left_reactor</span> to <em>nothing</em>;</li>
<li>from the point of view of the second region of <span class="tt">initializing</span> (path <span class="tt">0/initializing/1</span>), a transition from <span class="tt">deploying_right_wing</span> to <em>nothing</em>.</li>
</ol>
<p>These <em>transitions to nothing</em> happen because, from the point of view of the parent region, the source state is exited but no target state is entered.</p>
<h1 class="doxsection"><a class="anchor" id="external-transition-hook-null-state"></a>
Note: The Null Dummy State Object</h1>
<p>In some cases, the <span class="tt">source_state</span> and <span class="tt">target_state</span> parameters can be given <span class="tt"><a class="el" href="namespacemaki_1_1states.html#ac8429d4f0ce2e07aebae57fcb3883a9c" title="Dummy state object given to transition hooks.">maki::states::null</a></span>, a dummy <span class="tt"><a class="el" href="classmaki_1_1state.html" title="Represents a state.">maki::state</a></span> object whose pretty name is an empty string.</p>
<p>This dummy state is used to represent:</p><ul>
<li>the source state for transitions from pseudostates (such as the initial pseudostate);</li>
<li>the target state for transitions that exit the region. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="index.html">Maki</a></li><li class="navelem"><a href="extra.html">Extra Features</a></li><li class="navelem"><a href="hook.html">Hooks</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
