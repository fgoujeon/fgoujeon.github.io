<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Maki: Run-to-Completion</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Maki
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('run-to-completion.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Run-to-Completion </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__2home_2florian_2Development_2maki_2src_2doc_2concepts_2run-to-completion"></a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md23"></a>
Definition</h1>
<p>Run-to-completion is the guarantee that the processing of an event can't be interrupted by the processing of another event.</p>
<p>The simplest way to explain what run-to-completion is is to show what happens when it isn't guaranteed. Say you have a state machine of this form:</p>
<div class="plantumlgraph">
<img src="rtc_diagram.png" />
</div>
<p>Its actions are the following:</p>
<ul>
<li><span class="tt">say_hello_and_emit_E1()</span>, which outputs <span class="tt">"Hello,"</span> and emits the event <span class="tt">E1</span> (in this order);</li>
<li><span class="tt">say_world()</span>, which outputs <span class="tt">" World!"</span>.</li>
</ul>
<p>Whenever the active state is <span class="tt">A</span> and the event <span class="tt">E0</span> occurs, the state machine transitions from <span class="tt">A</span> to <span class="tt">B</span> and processes the event <span class="tt">E1</span>.</p>
<p>With run-to-completion, you'd have gotten this output:</p>
<div class="fragment"><div class="line">Hello, World!</div>
</div><!-- fragment --><p>Without run-to-completion, you get this one:</p>
<div class="fragment"><div class="line">Hello,</div>
</div><!-- fragment --><p>Frightening.</p>
<p>What is happening is that the processing of <span class="tt">E0</span> and the processing of <span class="tt">E1</span> are intertwined; the state machine:</p>
<ol type="1">
<li>performs some steps of the processing of <span class="tt">E0</span> (namely, invoking the exit action of <span class="tt">A</span>);</li>
<li>processes <span class="tt">E1</span> from beginning to end;</li>
<li>performs the remaining steps of the processing of <span class="tt">E0</span> (namely, invoking the entry action of <span class="tt">B</span> and marking it as the active state).</li>
</ol>
<p>Because of this, the state machine processes <span class="tt">E1</span> before it enters <span class="tt">B</span>, which results in <span class="tt">say_world()</span> not being called.</p>
<p>With run-to-completion, both events would have been fully processed in a sequential way.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md24"></a>
When to use run-to-completion</h1>
<p>Always use run-to-completion, unless you can't afford its performance penalty.</p>
<p>This feature indeed comes at a cost; to guarantee run-to-completion, a state machine library must use a queue of some sort to store the events its client asks to process while it's busy. This might involve memory allocation.</p>
<p>Obviously, if you dare disabling it, be <b>absolutely sure</b> none of your actions asks to process an event, neither directly nor indirectly. But be assured that the bigger your program and your development team, the harder it is to enforce.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md25"></a>
How to enable run-to-completion within Maki</h1>
<p>Being a safety feature, run-to-completion is enabled by default. You can disable it like so:</p>
<div class="fragment"><div class="line"><span class="keyword">constexpr</span> <span class="keyword">auto</span> machine_conf = <a class="code hl_class" href="classmaki_1_1machine__conf.html">maki::machine_conf</a>{}</div>
<div class="line">    .<a class="code hl_function" href="classmaki_1_1machine__conf.html#a429ce287b378d4c03f773aa8ea64f949">context_a</a>&lt;context&gt;()</div>
<div class="line">    .transition_tables(transition_table)</div>
<div class="line">    .run_to_completion(<span class="keyword">false</span>) <span class="comment">//&lt;-- Here</span></div>
<div class="line">;</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="index.html">Maki</a></li><li class="navelem"><a href="concepts.html">Concepts</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
